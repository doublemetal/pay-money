## Pay Money API

멀티인스턴스 환경에서 데이터 오류는 DBMS 의 원자성으로 간단하게 방어가 되도록 설계했습니다.
뿌리기나 받기 데이터가 대상이고, token 이 중복 생성되거나, 동시에 여러명이 뿌린 금액을 받을 수 있기 때문입니다.
중복이 발생한 경우는 재시도는 구현하지 않고 실패로만 처리합니다.
실제 서비스를 구현할 때는 이런 장치 위에 Queueing(받기 요청을 대기열에 추가) 이나
Distributed locking(받기 동작 수행시 멀티 인스턴스 모두에 locking) 등을 고려해보면 좋을 거 같습니다.


### 뿌리기 API

유효성검증: 값의 존재 유무등을 체크, 뿌릴 금액은 사람당 최소 1원, 4명이면 최소 4원

Token 중복 문제 : 랜덤생성 token 은 중복이 생길 확률이 있음, 10분의 유효시간이 있지만 요구사항이 3자리로 짧기 때문에 대비책이 필요합니다.
token, userId, roomId 의 복합키로 구성하여 중복되지 않도록 방어했습니다.
단, 이 상태에서 뿌리기의 유효시간이 지나면 뿌리기 row 가 더미데이터가 되는데도 key 공간을 차지하기 때문에 AI key 와 충분히 긴 token 으로 스펙을 변경하는 것도 고려해볼만합니다.

뿌리기 데이터는 메인 데이터(scatter) 와 분배건(scatter_detail) 로 구성하였고, 분배건은 최소 1원을 받을 수 있도록 랜덤으로 배정합니다. 


### 받기 API

DBMS 의 원자성을 이용하기 위해 detail 테이블에 분배건을 할당하지 않고, 받기요청사용자(userId) 필드를 맵핑 테이블로 떼내어 insert 하는 방식으로 구현 


### 조회 API


